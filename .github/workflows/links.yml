name: Links

on:
    deployment_status:

jobs:
  ## CHECKS ALL LINKS IN GUIDES
  ## RUNS AFTER VERCEL LINK IS DEPLOYED
  check-links:
    if: github.event_name == 'deployment_status' && github.event.deployment_status.state == 'success'
    name: Check Links
    runs-on: ubuntu-latest
    steps:
      # SETUP & INSTALL
      - name: Checkout repo
        uses: actions/checkout@v3
      - uses: ./.github/actions/setup-node
        with:
          install: false
      # RUN SCRIPT TO USE VERCEL PREVIEW LINK FROM PR
      - name: Update preview link
        run: node scripts/generate-mlc-config.mjs {{ github.head_ref }}
      # RUN SCRIPT TO GENERATE NEW CONFIG WITH VERCEL PREVIEW URL
      # RUN LINK CHECK
      - uses: gaurav-nelson/github-action-markdown-link-check
        with:
          config-file: 'mlc-config.json'
          file-extension: 'mdx'
          # use-verbose-mode: 'yes'
          folder-path: docs/guides/docs
